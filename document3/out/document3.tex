\documentclass{article}
% generated by Madoko, version 1.1.3
%mdk-data-line={1}


\usepackage[heading-base={2},section-num={False},bib-label={hide},fontspec={True}]{madoko2}
\usepackage{[UTF8/]ctex}


\begin{document}



%mdk-data-line={3}
\section{\mdline{3}1.\hspace*{0.5em}\mdline{3}实验配置}\label{section}%mdk%mdk

%mdk-data-line={4}
\subsection{\mdline{4}1.1.\hspace*{0.5em}\mdline{4}机器配置}\label{section}%mdk%mdk

%mdk-data-line={5}
\noindent\mdline{5}16G 内存，4核，50G 硬盘%mdk

%mdk-data-line={7}
\subsection{\mdline{7}1.2.\hspace*{0.5em}\mdline{7}数据传输}\label{section}%mdk%mdk

%mdk-data-line={8}
\noindent\mdline{8}mysql 10.1.90.25\mdline{8}(\mdline{8}数据库\mdline{8})\mdline{8} \mdline{8}\textendash{}\mdline{8}\textgreater{}\mdline{8} 10.1.90.36\mdline{8}(\mdline{8}es\mdline{8})\mdline{8}    \mdline{8}\mdbr
\mdline{9}网络传输的影响应该可以忽略不计了%mdk

%mdk-data-line={11}
\subsection{\mdline{11}1.3.\hspace*{0.5em}\mdline{11}es、logstash配置相关}\label{sec-eslogstash}%mdk%mdk

%mdk-data-line={12}
\begin{itemize}[noitemsep,topsep=\mdcompacttopsep]%mdk

%mdk-data-line={12}
\item\mdline{12}版本：5.5.1    \mdline{12} \mdline{12}%mdk

%mdk-data-line={13}
\item\mdline{13}内存：         \mdline{13}\mdbr
\mdline{14}-Xms4g     \mdline{14}\mdbr
\mdline{15}-Xmx4g           \mdline{15}\mdbr
\mdline{16}-XX:+UseConcMarkSweepGC               \mdline{16}\mdbr
\mdline{17}-XX:CMSInitiatingOccupancyFraction=75             \mdline{17}\mdbr
\mdline{18}-XX:+UseCMSInitiatingOccupancyOnly            \mdline{18}\mdbr
\mdline{19}-Xss1m       \mdline{19}\mdbr
\mdline{20}-XX:+AlwaysPreTouch     \mdline{20}\mdbr
\mdline{21}-Djava.awt.headless=true            \mdline{21} \mdline{21}%mdk
%mdk
\end{itemize}%mdk

%mdk-data-line={24}
\section{\mdline{24}2.\hspace*{0.5em}\mdline{24}实验（indexing）}\label{sec-indexing}%mdk%mdk

%mdk-data-line={26}
\subsection{\mdline{26}2.1.\hspace*{0.5em}\mdline{26}3分片、0备份、同一网段下，1,394,000条记录：}\label{sec-301394000}%mdk%mdk

%mdk-data-line={27}
\noindent\mdline{27}\mdcode{logstash~-w~1}\mdline{27} 1个worker           \mdline{27}\mdbr
\mdline{28}\mdcode{"refresh\_interval":~"1s",~"\_all":~\{~"enabled":~true~\}}\mdline{28} 每秒刷新index，可全字段搜索%mdk

%mdk-data-line={30}
\mdline{30}{}[\mdline{30}2017-08-01T16:37:20,872\mdline{30}]\mdline{30}{}[\mdline{30}INFO \mdline{30}]\mdline{30}{}[\mdline{30}logstash.inputs.jdbc     \mdline{30}]\mdline{30} \mdline{30}(\mdline{30}1.673000s\mdline{30})\mdline{30} SELECT id, data\mdline{30}\_\mdline{30}status, i\mdline{30}\_\mdline{30}name from lh\mdline{30}\_\mdline{30}dna\mdline{30}\_\mdline{30}ccgc\mdline{30}\_\mdline{30}punish\mdline{30}\_\mdline{30}data               \mdline{30}\mdbr
\mdline{31}{}[\mdline{31}2017-08-01T16:41:27,270\mdline{31}]\mdline{31}{}[\mdline{31}WARN \mdline{31}]\mdline{31}{}[\mdline{31}logstash.agent           \mdline{31}]\mdline{31} stopping pipeline \{:id=\mdline{31}\textgreater{}\mdline{31}\textquotedblleft{}main\textquotedblright{}\mdline{31}\}                 \mdline{31}\mdbr
\mdline{32}耗时04:07          \mdline{32} \mdline{32}%mdk

%mdk-data-line={35}
\subsection{\mdline{35}2.2.\hspace*{0.5em}\mdline{35}重复实验，3分片、0备份，1,394,000条记录：}\label{sec-301394000}%mdk%mdk

%mdk-data-line={36}
\noindent\mdline{36}logstash\mdline{36} \mdline{36}-w 1
\mdline{37}\textquotedblleft{}refresh\_interval\textquotedblright{}\mdline{37}: \mdline{37}\textquotedblleft{}1s\textquotedblright{}\mdline{37}, \mdline{37}\textquotedblleft{}\_all\textquotedblright{}\mdline{37}: \{ \mdline{37}\textquotedblleft{}enabled\textquotedblright{}\mdline{37}: true \} 同上        \mdline{37} \mdline{37}%mdk

%mdk-data-line={39}
\mdline{39}{}[\mdline{39}2017-08-02T09:33:53,753\mdline{39}]\mdline{39}{}[\mdline{39}INFO \mdline{39}]\mdline{39}{}[\mdline{39}logstash.inputs.jdbc     \mdline{39}]\mdline{39} \mdline{39}(\mdline{39}3.936000s\mdline{39})\mdline{39} SELECT id, data\mdline{39}\_\mdline{39}status, i\mdline{39}\_\mdline{39}name from lh\mdline{39}\_\mdline{39}dna\mdline{39}\_\mdline{39}ccgc\mdline{39}\_\mdline{39}punish\mdline{39}\_\mdline{39}data              \mdline{39}\mdbr
\mdline{40}{}[\mdline{40}2017-08-02T09:37:15,028\mdline{40}]\mdline{40}{}[\mdline{40}WARN \mdline{40}]\mdline{40}{}[\mdline{40}logstash.agent           \mdline{40}]\mdline{40} stopping pipeline \{:id=\mdline{40}\textgreater{}\mdline{40}\textquotedblleft{}main\textquotedblright{}\mdline{40}\}‘              \mdline{40}\mdbr
\mdline{41}耗时03:22          \mdline{41} \mdline{41}%mdk

%mdk-data-line={44}
\subsection{\mdline{44}2.3.\hspace*{0.5em}\mdline{44}3分片、0备份，3,000,000条记录：}\label{sec-303000000}%mdk%mdk

%mdk-data-line={45}
\noindent\mdline{45}logstash\mdline{45} \mdline{45}-w 1
\mdline{46}\textquotedblleft{}refresh\_interval\textquotedblright{}\mdline{46}: \mdline{46}\textquotedblleft{}1s\textquotedblright{}\mdline{46}, \mdline{46}\textquotedblleft{}\_all\textquotedblright{}\mdline{46}: \{ \mdline{46}\textquotedblleft{}enabled\textquotedblright{}\mdline{46}: true \}同上        \mdline{46} \mdline{46}%mdk

%mdk-data-line={48}
\mdline{48}{}[\mdline{48}2017-08-02T09:45:14,604\mdline{48}]\mdline{48}{}[\mdline{48}INFO \mdline{48}]\mdline{48}{}[\mdline{48}logstash.inputs.jdbc     \mdline{48}]\mdline{48} \mdline{48}(\mdline{48}3.533000s\mdline{48})\mdline{48} SELECT id, data\mdline{48}\_\mdline{48}status, i\mdline{48}\_\mdline{48}name from lh\mdline{48}\_\mdline{48}dna\mdline{48}\_\mdline{48}ccgc\mdline{48}\_\mdline{48}punish\mdline{48}\_\mdline{48}data             \mdline{48}\mdbr
\mdline{49}{}[\mdline{49}2017-08-02T09:53:49,570\mdline{49}]\mdline{49}{}[\mdline{49}WARN \mdline{49}]\mdline{49}{}[\mdline{49}logstash.agent           \mdline{49}]\mdline{49} stopping pipeline \{:id=\mdline{49}\textgreater{}\mdline{49}\textquotedblleft{}main\textquotedblright{}\mdline{49}\}             \mdline{49}\mdbr
\mdline{50}耗时08:35          \mdline{50} \mdline{50}%mdk

%mdk-data-line={52}
\subsection{\mdline{52}2.4.\hspace*{0.5em}\mdline{52}3分片、0备份，5,000,000条记录：}\label{sec-305000000}%mdk%mdk

%mdk-data-line={53}
\noindent\mdline{53}logstash\mdline{53} \mdline{53}-w 1
\mdline{54}\textquotedblleft{}refresh\_interval\textquotedblright{}\mdline{54}: \mdline{54}\textquotedblleft{}1s\textquotedblright{}\mdline{54}, \mdline{54}\textquotedblleft{}\_all\textquotedblright{}\mdline{54}: \{ \mdline{54}\textquotedblleft{}enabled\textquotedblright{}\mdline{54}: true \}同上        \mdline{54} \mdline{54}%mdk

%mdk-data-line={56}
\mdline{56}{}[\mdline{56}2017-08-02T09:57:34,660\mdline{56}]\mdline{56}{}[\mdline{56}INFO \mdline{56}]\mdline{56}{}[\mdline{56}logstash.inputs.jdbc     \mdline{56}]\mdline{56} \mdline{56}(\mdline{56}7.709000s\mdline{56})\mdline{56} SELECT id, data\mdline{56}\_\mdline{56}status, i\mdline{56}\_\mdline{56}name from lh\mdline{56}\_\mdline{56}dna\mdline{56}\_\mdline{56}ccgc\mdline{56}\_\mdline{56}punish\mdline{56}\_\mdline{56}data             \mdline{56}\mdbr
\mdline{57}{}[\mdline{57}2017-08-02T10:58:53,819\mdline{57}]\mdline{57}{}[\mdline{57}WARN \mdline{57}]\mdline{57}{}[\mdline{57}logstash.agent           \mdline{57}]\mdline{57} stopping pipeline \{:id=\mdline{57}\textgreater{}\mdline{57}\textquotedblleft{}main\textquotedblright{}\mdline{57}\}             \mdline{57}\mdbr
\mdline{58}耗时01:01:19          \mdline{58}\mdbr
\mdline{59}注：此处为logstash瓶颈，设置了heap内存可解决，在下面的800w试验中优化了配置             \mdline{59} \mdline{59}%mdk

%mdk-data-line={62}
\subsection{\mdline{62}2.5.\hspace*{0.5em}\mdline{62}3分片、0备份，8,000,000条记录：}\label{sec-308000000}%mdk%mdk

%mdk-data-line={63}
\noindent\mdline{63}logstash\mdline{63} \mdline{63}-w 4\mdline{63} \mdline{63}-xms4g\mdline{63} \mdline{63}-xmx4g 4个worker（数量等于cpu核数，堆内存优化）             \mdline{63}\mdbr
\mdline{64}\textquotedblleft{}refresh\_interval\textquotedblright{}\mdline{64}: \mdline{64}\textquotedblleft{}-1\textquotedblright{}\mdline{64}, \mdline{64}\textquotedblleft{}\_all\textquotedblright{}\mdline{64}: \{ \mdline{64}\textquotedblleft{}enabled\textquotedblright{}\mdline{64}: false \}              \mdline{64}\mdbr
\mdline{65}注：不使用每秒刷新index（实时搜索才需要），all字段不可用于搜索（一般只对某字段搜索，取消后索引占用空间也减少了一半左右）。             \mdline{65} \mdline{65}%mdk

%mdk-data-line={67}
\mdline{67}{}[\mdline{67}2017-08-02T11:09:16,058\mdline{67}]\mdline{67}{}[\mdline{67}INFO \mdline{67}]\mdline{67}{}[\mdline{67}logstash.inputs.jdbc     \mdline{67}]\mdline{67} \mdline{67}(\mdline{67}8.827000s\mdline{67})\mdline{67} SELECT id, data\mdline{67}\_\mdline{67}status, i\mdline{67}\_\mdline{67}name from lh\mdline{67}\_\mdline{67}dna\mdline{67}\_\mdline{67}ccgc\mdline{67}\_\mdline{67}punish\mdline{67}\_\mdline{67}data             \mdline{67}\mdbr
\mdline{68}{}[\mdline{68}2017-08-02T11:25:59,260\mdline{68}]\mdline{68}{}[\mdline{68}WARN \mdline{68}]\mdline{68}{}[\mdline{68}logstash.agent           \mdline{68}]\mdline{68} stopping pipeline \{:id=\mdline{68}\textgreater{}\mdline{68}\textquotedblleft{}main\textquotedblright{}\mdline{68}\}             \mdline{68}\mdbr
\mdline{69}耗时16:43          \mdline{69}\mdbr
\mdline{70}注：中间查看系统负载load average: 6.12, 3.99, 3.00 打满的状况（感觉负载有点高）             \mdline{70} \mdline{70}%mdk

%mdk-data-line={72}
\section{\mdline{72}3.\hspace*{0.5em}\mdline{72}实验日志相关}\label{section}%mdk%mdk

%mdk-data-line={73}
\subsection{\mdline{73}3.1.\hspace*{0.5em}\mdline{73}内存详细日志}\label{section}%mdk%mdk

%mdk-data-line={74}
\noindent\mdline{74}在2.2-2.4的实验进行中执行jstat\mdline{74} \mdline{74}-gc\mdline{74} \mdline{74}-h5 4409 3s，日志分别是     \mdline{74}\mdbr
\mdline{75}test-100w\mdline{75}\_\mdline{75}indexing.log     \mdline{75}\mdbr
\mdline{76}test-300w\mdline{76}\_\mdline{76}indexing.log     \mdline{76}\mdbr
\mdline{77}test-500w\mdline{77}\_\mdline{77}indexing.log     \mdline{77}\mdbr
\mdline{78}test-800w\mdline{78}\_\mdline{78}indexing.log     \mdline{78} \mdline{78}%mdk

%mdk-data-line={80}
\subsection{\mdline{80}3.2.\hspace*{0.5em}\mdline{80}总览数据}\label{section}%mdk%mdk

%mdk-data-line={81}
\noindent\mdline{81}可在Grafana中选择上面实验的时间区间查看以及对比查看     \mdline{81} \mdline{81}%mdk

%mdk-data-line={85}
%mdk-data-line={86}
\noindent\mdline{86}Enjoy! By Hanbing.    \mdline{86}\mdbr
\mdline{87}Using madoko.%mdk%mdk%mdk


\end{document}
